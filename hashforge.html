<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HashForge</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=VT323&family=Inconsolata:wght@400;500;600&display=swap');
  :root {
    --green:#00ff41;--green-dim:#00cc35;--green-dark:#003b0f;
    --green-glow:rgba(0,255,65,0.1);--bg:#020a04;--bg2:#061209;
    --border:#00ff4144;--text:#dfffea;--text-dim:#6daa7a;
    --red:#ff3131;--yellow:#ffe533;
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{background:var(--bg);color:var(--text);font-family:'Inconsolata',monospace;font-size:24px;line-height:1.7;min-height:100vh;overflow-x:hidden;}
  body::before{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,0.07) 2px,rgba(0,0,0,0.07) 4px);pointer-events:none;z-index:9999;}
  @keyframes flicker{0%,100%{opacity:1;}93%{opacity:.97;}96%{opacity:.99;}}
  body{animation:flicker 10s infinite;}
  .container{max-width:920px;margin:0 auto;padding:24px 20px;}
  header{border-bottom:1px solid var(--border);padding-bottom:16px;margin-bottom:24px;display:flex;align-items:center;gap:20px;flex-wrap:wrap;}
  .logo{font-family:'VT323',monospace;font-size:52px;color:var(--green);text-shadow:0 0 20px var(--green),0 0 40px rgba(0,255,65,.25);letter-spacing:6px;line-height:1;}
  .logo-sub{color:var(--text-dim);font-size:15px;letter-spacing:2px;margin-top:4px;}
  .status-bar{margin-left:auto;display:flex;gap:20px;align-items:center;font-size:13px;color:var(--text-dim);letter-spacing:1px;}
  .dot{width:6px;height:6px;border-radius:50%;background:var(--green);box-shadow:0 0 6px var(--green);display:inline-block;margin-right:6px;animation:pulse 2.5s infinite;}
  @keyframes pulse{0%,100%{opacity:1;}50%{opacity:.2;}}
  .panel{background:var(--bg2);border:1px solid var(--border);padding:18px;margin-bottom:14px;position:relative;}
  .panel::before{content:'';position:absolute;top:0;left:0;width:2px;height:100%;background:linear-gradient(to bottom,var(--green),transparent);opacity:.6;}
  .section-label{font-size:15px;letter-spacing:2px;color:var(--text-dim);margin-bottom:12px;text-transform:uppercase;}
  .phrase-input{width:100%;background:transparent;border:none;border-bottom:1px solid var(--border);color:var(--green);font-family:'Inconsolata',monospace;font-size:18px;padding:8px 0;outline:none;caret-color:var(--green);letter-spacing:1px;}
  .phrase-input::placeholder{color:var(--text-dim);font-size:14px;}
  .phrase-input:focus{border-bottom-color:var(--green);text-shadow:0 0 8px rgba(0,255,65,.3);}
  .normalized-preview{margin-top:10px;font-size:16px;color:var(--text-dim);min-height:18px;letter-spacing:1px;}
  .norm-val{color:var(--green-dim);letter-spacing:2px;word-break:break-all;}
  .algo-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(148px,1fr));gap:8px;}
  .algo-btn{background:transparent;border:1px solid var(--border);color:var(--text-dim);font-family:'Inconsolata',monospace;font-size:14px;padding:10px 12px;cursor:pointer;text-align:left;transition:all .12s;letter-spacing:1px;}
  .algo-btn:hover{border-color:var(--green-dim);color:var(--text);background:var(--green-glow);}
  .algo-family{font-size:13px;color:var(--text-dim);display:block;margin-bottom:3px;letter-spacing:2px;}
  .algo-note{font-size:13px;color:var(--text-dim);display:block;margin-top:2px;letter-spacing:0;}
  .algo-btn:hover .algo-family{color:var(--green-dim);}
  .sha1-warning{margin-top:16px;border:1px solid rgba(255,51,49,.25);background:rgba(255,51,49,.04);padding:12px 14px;}
  .sha1-warning-label{font-size:12px;letter-spacing:2px;color:var(--red);margin-bottom:6px;text-transform:uppercase;}
  .sha1-warning-desc{font-size:16px;color:var(--text-dim);line-height:1.7;letter-spacing:.5px;}
  .sha1-warning-desc strong{color:var(--red);}
  .algo-btn-warn{border-color:rgba(255,51,49,.3)!important;color:var(--red)!important;opacity:.8;}
  .algo-btn-warn .algo-family{color:rgba(255,51,49,.6)!important;}
  .algo-btn-warn .algo-note{color:rgba(255,51,49,.5)!important;}
  .algo-btn-warn:hover{border-color:var(--red)!important;background:rgba(255,51,49,.08)!important;opacity:1;}
  .pipeline-area{min-height:52px;border:1px dashed var(--border);padding:10px;display:flex;flex-wrap:wrap;gap:6px;align-items:center;background:rgba(0,0,0,.25);}
  .pipeline-empty{color:var(--text-dim);font-size:16px;letter-spacing:1px;width:100%;text-align:center;}
  .pipeline-item{background:var(--green-dark);border:1px solid var(--green-dim);color:var(--green);font-family:'Inconsolata',monospace;font-size:16px;padding:6px 12px;display:flex;align-items:center;gap:8px;letter-spacing:1px;animation:slidein .18s ease;}
  @keyframes slidein{from{opacity:0;transform:translateX(-6px);}to{opacity:1;transform:none;}}
  .pipeline-arrow{color:var(--text-dim);font-size:18px;line-height:1;}
  .rm-btn{background:none;border:none;color:var(--text-dim);cursor:pointer;font-family:'Inconsolata',monospace;font-size:14px;line-height:1;padding:0;}
  .rm-btn:hover{color:var(--red);}
  .btn{background:transparent;border:1px solid var(--border);color:var(--text-dim);font-family:'Inconsolata',monospace;font-size:16px;padding:8px 16px;cursor:pointer;letter-spacing:2px;text-transform:uppercase;transition:all .12s;}
  .btn:hover{border-color:var(--text-dim);color:var(--text);}
  .btn-primary{border-color:var(--green);color:var(--green);font-size:16px;padding:11px 28px;letter-spacing:3px;}
  .btn-primary:hover{background:var(--green-glow);box-shadow:0 0 20px rgba(0,255,65,.15);}
  .btn-primary:active{transform:scale(.98);}
  .btn-danger:hover{border-color:var(--red);color:var(--red);}
  .output-panel{display:none;}
  .output-panel.visible{display:block;}
  .hash-step{margin-bottom:14px;animation:fadeup .25s ease;}
  @keyframes fadeup{from{opacity:0;transform:translateY(5px);}to{opacity:1;transform:none;}}
  .hash-step-label{font-size:15px;letter-spacing:2px;color:var(--text-dim);margin-bottom:5px;}
  .hash-value{background:rgba(0,0,0,.4);border:1px solid var(--border);padding:10px 12px;word-break:break-all;color:var(--green);font-size:14px;letter-spacing:1px;line-height:1.8;cursor:pointer;transition:border-color .12s;position:relative;}
  .hash-value:hover{border-color:var(--green-dim);}
  .copy-hint{position:absolute;right:10px;top:50%;transform:translateY(-50%);font-size:16px;color:var(--text-dim);letter-spacing:2px;opacity:0;transition:opacity .15s;pointer-events:none;}
  .hash-value:hover .copy-hint{opacity:1;}
  .hash-value.copied{border-color:var(--yellow)!important;}
  .hash-value.copied .copy-hint{opacity:1;color:var(--yellow);}
  .final-hash{border-color:var(--green);box-shadow:0 0 14px rgba(0,255,65,.08);font-size:13px;}
  .profile-row{display:flex;gap:8px;margin-bottom:12px;}
  .profile-input{flex:1;background:transparent;border:1px solid var(--border);color:var(--text);font-family:'Inconsolata',monospace;font-size:16px;padding:6px 10px;outline:none;letter-spacing:1px;}
  .profile-input:focus{border-color:var(--green-dim);}
  .profile-list{display:flex;flex-direction:column;gap:6px;max-height:200px;overflow-y:auto;}
  .profile-item{display:flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid var(--border);background:rgba(0,0,0,.2);cursor:pointer;transition:all .12s;}
  .profile-item:hover{border-color:var(--green-dim);background:var(--green-glow);}
  .profile-name{color:var(--green-dim);font-size:14px;letter-spacing:1px;flex:0 0 auto;min-width:100px;}
  .profile-pipe{color:var(--text-dim);font-size:15px;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
  .profile-del{background:none;border:none;color:var(--text-dim);cursor:pointer;font-family:'Inconsolata',monospace;font-size:14px;padding:0 4px;flex:0 0 auto;}
  .profile-del:hover{color:var(--red);}
  .profiles-empty{color:var(--text-dim);font-size:16px;letter-spacing:1px;text-align:center;padding:16px;}
  .salt-panel{border-color:rgba(0,204,53,.4);}
  .salt-info{font-size:14px;color:var(--text-dim);line-height:1.8;margin-bottom:14px;padding:12px 14px;border:1px solid rgba(0,204,53,.2);background:rgba(0,204,53,.04);}
  .salt-info strong{color:var(--green);}
  .salt-info code{color:var(--green-dim);font-family:'Inconsolata',monospace;font-size:13px;background:rgba(0,0,0,.3);padding:2px 6px;}
  .export-check{display:flex;align-items:center;gap:8px;font-size:16px;color:var(--text-dim);letter-spacing:1px;cursor:pointer;user-select:none;}
  .export-check input{accent-color:var(--green);width:14px;height:14px;cursor:pointer;}
  .export-check:hover{color:var(--text);}
  .notice{background:rgba(0,255,65,.03);border:1px solid rgba(0,255,65,.15);color:var(--green-dim);font-size:16px;padding:10px 14px;letter-spacing:1px;margin-bottom:14px;line-height:1.7;}
  .notice strong{color:var(--green);}
  .section-desc{font-size:16px;color:var(--text-dim);margin-bottom:14px;line-height:1.7;letter-spacing:.5px;}
  footer{margin-top:28px;padding-top:12px;border-top:1px solid var(--border);display:flex;justify-content:space-between;font-size:15px;color:var(--text-dim);letter-spacing:2px;flex-wrap:wrap;gap:8px;}
  .lang-btn{background:transparent;border:1px solid var(--border);color:var(--text-dim);font-family:'Inconsolata',monospace;font-size:13px;padding:4px 10px;cursor:pointer;letter-spacing:2px;text-transform:uppercase;transition:all .12s;}
  .lang-btn:hover,.lang-btn.active{border-color:var(--green);color:var(--green);}
  @keyframes blink{0%,100%{opacity:1;}50%{opacity:0;}}
  .cursor{animation:blink 1s infinite;}
  ::-webkit-scrollbar{width:4px;}
  ::-webkit-scrollbar-track{background:var(--bg);}
  ::-webkit-scrollbar-thumb{background:var(--green-dark);border-radius:2px;}
  ::-webkit-scrollbar-thumb:hover{background:var(--green-dim);}
  @media(max-width:580px){.logo{font-size:38px;}.status-bar{margin-left:0;}.algo-grid{grid-template-columns:repeat(auto-fill,minmax(130px,1fr));}}
</style>
</head>
<body>
<div class="container">

  <header>
    <div>
      <div class="logo">HASHFORGE<span class="cursor">_</span></div>
      <div class="logo-sub">ENTROPY PIPELINE GENERATOR // v0.3.0 // WEB CRYPTO API</div>
    </div>
    <div class="status-bar">
      <span><span class="dot"></span>OFFLINE</span>
      <span id="clock"></span>
      <span>
        <button class="lang-btn active" id="btn-pt" onclick="setLang('pt')">PT</button>
        <button class="lang-btn" id="btn-en" onclick="setLang('en')">EN</button>
      </span>
    </div>
  </header>

  <div class="notice">
    <strong>âœ“ 100% OFFLINE</strong> â€” <span data-i18n="notice"></span>
  </div>

  <!-- 01 FRASE -->
  <div class="panel">
    <div class="section-label" data-i18n="s01">01 // entrada de frase</div>
    <input type="text" class="phrase-input" id="phraseInput"
      placeholder="digite sua frase aqui..."
      autocomplete="off" spellcheck="false"/>
    <div class="normalized-preview" id="normPreview">aguardando entrada...</div>
  </div>

  <!-- 02 ALGORITMOS -->
  <div class="panel">
    <div class="section-label" data-i18n="s02">02 // selecione os algoritmos</div>
    <div class="section-desc">
      <span data-i18n="algoDesc"></span>
    </div>
    <div class="algo-grid">
      <button class="algo-btn" data-algo="SHA-256">
        <span class="algo-family">SHA-2</span>SHA-256
        <span class="algo-note">256 bits</span>
      </button>
      <button class="algo-btn" data-algo="SHA-384">
        <span class="algo-family">SHA-2</span>SHA-384
        <span class="algo-note">384 bits</span>
      </button>
      <button class="algo-btn" data-algo="SHA-512">
        <span class="algo-family">SHA-2</span>SHA-512
        <span class="algo-note">512 bits</span>
      </button>
      <button class="algo-btn" data-algo="PBKDF2-SHA256">
        <span class="algo-family">KDF</span>PBKDF2-SHA256
        <span class="algo-note" data-i18n="iter">100k iteraÃ§Ãµes</span>
      </button>
      <button class="algo-btn" data-algo="PBKDF2-SHA512">
        <span class="algo-family">KDF</span>PBKDF2-SHA512
        <span class="algo-note" data-i18n="iter">100k iteraÃ§Ãµes</span>
      </button>
      <button class="algo-btn" data-algo="HKDF-SHA256">
        <span class="algo-family">KDF</span>HKDF-SHA256
        <span class="algo-note" data-i18n="keyDeriv">derivaÃ§Ã£o de chave</span>
      </button>
      <button class="algo-btn" data-algo="HKDF-SHA512">
        <span class="algo-family">KDF</span>HKDF-SHA512
        <span class="algo-note" data-i18n="keyDeriv">derivaÃ§Ã£o de chave</span>
      </button>
    </div>

    <div class="sha1-warning">
      <div class="sha1-warning-label" data-i18n="sha1Label">âš  ALGORITMO LEGADO â€” USO RESTRITO</div>
      <div class="sha1-warning-desc">
        <span data-i18n="sha1Desc"></span>
      </div>
      <div class="algo-grid" style="margin-top:10px;">
        <button class="algo-btn algo-btn-warn" data-algo="SHA-1">
          <span class="algo-family">SHA-1 âš </span>SHA-1
          <span class="algo-note" data-i18n="sha1Note">somente etapa intermediÃ¡ria</span>
        </button>
      </div>
    </div>
  </div>

  <!-- 03 PIPELINE -->
  <div class="panel">
    <div class="section-label" data-i18n="s03">03 // pipeline</div>
    <div class="pipeline-area" id="pipelineArea">
      <span class="pipeline-empty" data-i18n="pipelineEmpty">nenhum algoritmo selecionado â€” clique nos botÃµes acima para adicionar</span>
    </div>
    <div style="margin-top:10px;">
      <button class="btn btn-danger" onclick="clearPipeline()" data-i18n="clearBtn">limpar pipeline</button>
    </div>
  </div>


  <!-- 03b SALT -->
  <div class="panel salt-panel" id="saltPanel" style="display:none;">
    <div class="section-label" data-i18n="s03b">03b // salt pessoal</div>
    <div class="salt-info" id="saltInfo"></div>
    <input type="text" class="phrase-input" id="saltInput"
      autocomplete="off" spellcheck="false" value="hashforge-v2"/>
    <div class="normalized-preview" id="saltPreview"></div>
  </div>

  <!-- RUN -->
  <div style="display:flex;gap:16px;align-items:center;margin-bottom:14px;flex-wrap:wrap;">
    <button class="btn btn-primary" onclick="runPipeline()" data-i18n="runBtn">â–¶ EXECUTAR PIPELINE</button>
    <span id="runStatus" style="font-size:16px;color:var(--text-dim);letter-spacing:2px;"></span>
  </div>

  <!-- 04 OUTPUT -->
  <div class="panel output-panel" id="outputPanel">
    <div class="section-label" data-i18n="s04">04 // resultado</div>
    <div id="hashSteps"></div>
    <div style="margin-top:14px;margin-bottom:12px;display:flex;gap:20px;flex-wrap:wrap;">
      <label class="export-check"><input type="checkbox" id="exportPhrase"> <span data-i18n="exportPhrase">incluir frase original</span></label>
      <label class="export-check"><input type="checkbox" id="exportNorm"> <span data-i18n="exportNorm">incluir frase normalizada</span></label>
    </div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button class="btn" onclick="exportTxt()" data-i18n="exportTxt">â¬‡ exportar .txt</button>
      <button class="btn btn-primary" style="font-size:16px;padding:8px 16px;letter-spacing:2px;" onclick="exportEncrypted()" data-i18n="exportEnc">ðŸ”’ exportar .enc (criptografado)</button>
    </div>
  </div>

  <!-- 05 PERFIS -->
  <div class="panel">
    <div class="section-label" data-i18n="s05">05 // perfis salvos</div>
    <div class="profile-row">
      <input type="text" class="profile-input" id="profileName" spellcheck="false"/>
      <button class="btn" onclick="saveProfile()" data-i18n="saveProfile">salvar pipeline atual</button>
    </div>
    <div class="profile-list" id="profileList"></div>
  </div>

  <footer>
    <span data-i18n="footer1">HASHFORGE v0.3.0 // USO PESSOAL</span>
    <span data-i18n="footer2">WEB CRYPTO API // ZERO DEPENDÃŠNCIAS</span>
    <span id="footerClock"></span>
  </footer>
</div>

<script>
'use strict';

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let pipeline = [];
let profiles = [];
try { profiles = JSON.parse(localStorage.getItem('hf_profiles') || '[]'); } catch(e) {}

// â”€â”€ CLOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function tick() {
  const s = new Date().toISOString().replace('T',' ').substring(0,19) + ' UTC';
  document.getElementById('clock').textContent = s;
  document.getElementById('footerClock').textContent = s;
}
setInterval(tick, 1000); tick();

// â”€â”€ PHRASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('phraseInput').addEventListener('input', function() {
  const norm = this.value.replace(/\s/g,'').toLowerCase();
  const el = document.getElementById('normPreview');
  el.innerHTML = this.value
    ? LANGS[currentLang].normLabel + '<span class="norm-val">' + (norm || LANGS[currentLang].normEmpty) + '</span>'
    : LANGS[currentLang].normWaiting;
});

function getNorm() {
  return document.getElementById('phraseInput').value.replace(/\s/g,'').toLowerCase();
}

// â”€â”€ PIPELINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.querySelectorAll('.algo-btn').forEach(btn => {
  btn.addEventListener('click', () => { pipeline.push(btn.dataset.algo); renderPipeline(); });
});

function renderPipeline() {
  const area = document.getElementById('pipelineArea');
  area.innerHTML = '';
  if (!pipeline.length) {
    area.innerHTML = '<span class="pipeline-empty">' + LANGS[currentLang].pipelineEmpty + '</span>';
    return;
  }
  updateSaltPanel();
  pipeline.forEach((algo, i) => {
    if (i > 0) {
      const arr = document.createElement('span');
      arr.className = 'pipeline-arrow'; arr.textContent = 'â†’';
      area.appendChild(arr);
    }
    const item = document.createElement('div'); item.className = 'pipeline-item';
    const lbl = document.createElement('span'); lbl.textContent = algo;
    const rm  = document.createElement('button'); rm.className = 'rm-btn'; rm.textContent = 'Ã—'; rm.title = LANGS[currentLang].pipelineRmTitle;
    rm.addEventListener('click', () => { pipeline.splice(i, 1); renderPipeline(); });
    item.appendChild(lbl); item.appendChild(rm); area.appendChild(item);
  });
}

function clearPipeline() {
  pipeline = []; renderPipeline(); updateSaltPanel();
  document.getElementById('outputPanel').classList.remove('visible');
  document.getElementById('runStatus').textContent = '';
}

// â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function hexToBytes(hex) {
  const b = new Uint8Array(hex.length / 2);
  for (let i = 0; i < hex.length; i += 2) b[i/2] = parseInt(hex.substr(i,2), 16);
  return b;
}
function bytesToHex(b) {
  return Array.from(b).map(x => x.toString(16).padStart(2,'0')).join('');
}
function isHexStr(s) { return /^[0-9a-f]{32,}$/i.test(s) && s.length % 2 === 0; }


// â”€â”€ SALT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const KDF_ALGOS = ['PBKDF2-SHA256', 'PBKDF2-SHA512', 'HKDF-SHA256', 'HKDF-SHA512'];

function getKdfsInPipeline() {
  return pipeline.filter(a => KDF_ALGOS.includes(a));
}

function updateSaltPanel() {
  const kdfs = getKdfsInPipeline();
  const panel = document.getElementById('saltPanel');
  const saltInput = document.getElementById('saltInput');
  const saltPreview = document.getElementById('saltPreview');
  const saltInfo = document.getElementById('saltInfo');
  const t = LANGS[currentLang];

  if (kdfs.length === 0) {
    panel.style.display = 'none';
    return;
  }

  panel.style.display = 'block';

  // Update section label
  panel.querySelector('.section-label').textContent = t.s03b;

  // Update info text with algorithm names
  saltInfo.innerHTML = t.saltInfo.replace('{algos}', kdfs.join(', '));

  // Update placeholder
  saltInput.placeholder = t.saltPh;

  // Update preview
  const val = saltInput.value.trim();
  if (!val) {
    saltPreview.innerHTML = '<span style="color:var(--yellow)">' + t.saltWarning + '</span>';
  } else if (val === 'hashforge-v2') {
    saltPreview.innerHTML = t.saltPreview + '<span class="norm-val">' + val + '</span> <span style="color:var(--yellow);font-size:13px;">(' + t.saltDefault + ')</span>';
  } else {
    saltPreview.innerHTML = t.saltPreview + '<span class="norm-val">' + val + '</span> <span style="color:var(--green);font-size:13px;">(' + t.saltCustom + ')</span>';
  }
}

document.getElementById('saltInput').addEventListener('input', updateSaltPanel);

function getSalt() {
  const val = document.getElementById('saltInput').value.trim();
  return val || 'hashforge-v2';
}

// â”€â”€ HASH ENGINE â€” 100% Web Crypto API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function computeHash(algo, input) {
  const isHex = isHexStr(input);
  const data  = isHex ? hexToBytes(input) : new TextEncoder().encode(input);

  switch (algo) {
    case 'SHA-1':   { const b = await crypto.subtle.digest('SHA-1',   data); return bytesToHex(new Uint8Array(b)); }
    case 'SHA-256': { const b = await crypto.subtle.digest('SHA-256', data); return bytesToHex(new Uint8Array(b)); }
    case 'SHA-384': { const b = await crypto.subtle.digest('SHA-384', data); return bytesToHex(new Uint8Array(b)); }
    case 'SHA-512': { const b = await crypto.subtle.digest('SHA-512', data); return bytesToHex(new Uint8Array(b)); }

    case 'PBKDF2-SHA256':
    case 'PBKDF2-SHA512': {
      const hash = algo === 'PBKDF2-SHA256' ? 'SHA-256' : 'SHA-512';
      const km   = await crypto.subtle.importKey('raw', data, { name: 'PBKDF2' }, false, ['deriveBits']);
      const salt = new TextEncoder().encode(getSalt());
      const bits = await crypto.subtle.deriveBits({ name: 'PBKDF2', salt, iterations: 100000, hash }, km, 256);
      return bytesToHex(new Uint8Array(bits));
    }

    case 'HKDF-SHA256':
    case 'HKDF-SHA512': {
      const hash = algo === 'HKDF-SHA256' ? 'SHA-256' : 'SHA-512';
      const km   = await crypto.subtle.importKey('raw', data, { name: 'HKDF' }, false, ['deriveBits']);
      const salt = new TextEncoder().encode(getSalt());
      const info = new TextEncoder().encode('hashforge-hkdf');
      const bits = await crypto.subtle.deriveBits({ name: 'HKDF', hash, salt, info }, km, 256);
      return bytesToHex(new Uint8Array(bits));
    }

    default: throw new Error(LANGS[currentLang].algoUnknown + algo);
  }
}

// â”€â”€ RUN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function runPipeline() {
  const phrase = getNorm();
  const status = document.getElementById('runStatus');
  if (!phrase)          { status.textContent = LANGS[currentLang].runErrPhrase; return; }
  if (!pipeline.length) { status.textContent = LANGS[currentLang].runErrPipeline; return; }

  status.textContent = LANGS[currentLang].runProcessing;
  const stepsEl = document.getElementById('hashSteps');
  stepsEl.innerHTML = '';
  document.getElementById('outputPanel').classList.add('visible');

  let current = phrase;
  for (let i = 0; i < pipeline.length; i++) {
    const algo    = pipeline[i];
    const isFinal = i === pipeline.length - 1;
    let result;
    try {
      result = await computeHash(algo, current);
    } catch(e) {
      appendStep(stepsEl, i+1, algo, 'ERRO: ' + e.message, true, false);
      status.textContent = LANGS[currentLang].runErrStep; return;
    }
    appendStep(stepsEl, i+1, algo, result, false, isFinal);
    current = result;
  }
  status.textContent = LANGS[currentLang].runDone;
  setTimeout(() => status.textContent = '', 3000);
}

function appendStep(container, num, algo, value, isError, isFinal) {
  const div = document.createElement('div'); div.className = 'hash-step';
  const lbl = document.createElement('div'); lbl.className = 'hash-step-label';
  lbl.textContent = `STEP ${num} // ${algo}${isFinal ? LANGS[currentLang].stepFinal : ''}`;
  const val = document.createElement('div');
  val.className = 'hash-value' + (isFinal ? ' final-hash' : '');
  if (isError) {
    val.style.color = 'var(--red)'; val.textContent = value;
  } else {
    val.textContent = value;
    const hint = document.createElement('span'); hint.className = 'copy-hint'; hint.textContent = LANGS[currentLang].copyHint;
    val.appendChild(hint);
    val.addEventListener('click', () => {
      navigator.clipboard.writeText(value).then(() => {
        val.classList.add('copied'); hint.textContent = LANGS[currentLang].copied;
        setTimeout(() => { val.classList.remove('copied'); hint.textContent = LANGS[currentLang].copyHint;
        }, 2000);
      }).catch(() => { hint.textContent = LANGS[currentLang].copyErr; });
    });
  }
  div.appendChild(lbl); div.appendChild(val); container.appendChild(div);
}

// â”€â”€ PROFILES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveProfiles() { try { localStorage.setItem('hf_profiles', JSON.stringify(profiles)); } catch(e) {} }

function saveProfile() {
  const name = document.getElementById('profileName').value.trim();
  if (!name)            { alert(LANGS[currentLang].alertProfileName); return; }
  if (!pipeline.length) { alert(LANGS[currentLang].alertPipelineEmpty); return; }
  profiles.push({ name, pipeline: [...pipeline] });
  saveProfiles(); renderProfiles();
  document.getElementById('profileName').value = '';
}

function loadProfile(i)      { pipeline = [...profiles[i].pipeline]; renderPipeline(); }
function deleteProfile(i, e) { e.stopPropagation(); profiles.splice(i, 1); saveProfiles(); renderProfiles(); }

// â”€â”€ BUILD TXT CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildTxtContent() {
  const steps = document.querySelectorAll('.hash-step');
  if (!steps.length) return null;
  const now           = new Date().toISOString().replace('T',' ').substring(0,19) + ' UTC';
  const savePhrase    = document.getElementById('exportPhrase').checked;
  const saveNorm      = document.getElementById('exportNorm').checked;
  const lines = [];
  lines.push('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  lines.push('  ' + LANGS[currentLang].txtHeader);
  lines.push('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  lines.push('');
  lines.push(LANGS[currentLang].txtDate + now);
  if (savePhrase) lines.push(LANGS[currentLang].txtPhrase + document.getElementById('phraseInput').value);
  if (saveNorm)   lines.push(LANGS[currentLang].txtNorm + getNorm());
  const kdfList = getKdfsInPipeline();
  if (kdfList.length > 0) lines.push(LANGS[currentLang].txtSalt + getSalt());
  lines.push(LANGS[currentLang].txtPipeline + pipeline.join(' â†’ '));
  lines.push('');
  lines.push('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
  lines.push('');
  steps.forEach(step => {
    const label = step.querySelector('.hash-step-label').textContent.trim();
    const valEl = step.querySelector('.hash-value');
    const value = Array.from(valEl.childNodes)
      .filter(n => n.nodeType === Node.TEXT_NODE)
      .map(n => n.textContent.trim()).join('');
    lines.push('  ' + label);
    lines.push('  ' + value);
    lines.push('');
  });
  lines.push('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
  lines.push(LANGS[currentLang].txtFooter);
  lines.push('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  return lines.join('\n');
}

// â”€â”€ EXPORT TXT (plain) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function exportTxt() {
  const content = buildTxtContent();
  if (!content) return;
  triggerDownload(
    new Blob([content], { type: 'text/plain;charset=utf-8' }),
    'hashforge-' + new Date().toISOString().substring(0,10) + '.txt'
  );
}

// â”€â”€ EXPORT ENCRYPTED (.enc â€” OpenSSL AES-256-CBC + PBKDF2 compatible) â”€â”€â”€â”€â”€â”€â”€â”€â”€
function exportEncrypted() {
  const content = buildTxtContent();
  if (!content) { alert(LANGS[currentLang].encAlertRun); return; }
  showPasswordModal(async (password) => {
    if (!password) return;
    try {
      // OpenSSL format: "Salted__" + 8-byte salt + ciphertext
      const salt       = crypto.getRandomValues(new Uint8Array(8));
      const passBytes  = new TextEncoder().encode(password);

      // Derive key+IV from password+salt using PBKDF2 (OpenSSL -pbkdf2 flag)
      // OpenSSL derives 48 bytes: first 32 = key, last 16 = IV
      const keyMaterial = await crypto.subtle.importKey('raw', passBytes, { name: 'PBKDF2' }, false, ['deriveBits']);
      const derived     = await crypto.subtle.deriveBits(
        { name: 'PBKDF2', salt, iterations: 10000, hash: 'SHA-256' },
        keyMaterial, 384 // 48 bytes = 384 bits
      );
      const derivedBytes = new Uint8Array(derived);
      const keyBytes     = derivedBytes.slice(0, 32);
      const iv           = derivedBytes.slice(32, 48);

      // Import AES-CBC key
      const aesKey = await crypto.subtle.importKey('raw', keyBytes, { name: 'AES-CBC' }, false, ['encrypt']);

      // Encrypt
      const plaintext   = new TextEncoder().encode(content);
      const ciphertext  = await crypto.subtle.encrypt({ name: 'AES-CBC', iv }, aesKey, plaintext);

      // Assemble: "Salted__" (8 bytes) + salt (8 bytes) + ciphertext
      const magic  = new TextEncoder().encode('Salted__');
      const output = new Uint8Array(8 + 8 + ciphertext.byteLength);
      output.set(magic, 0);
      output.set(salt,  8);
      output.set(new Uint8Array(ciphertext), 16);

      triggerDownload(
        new Blob([output], { type: 'application/octet-stream' }),
        'hashforge-' + new Date().toISOString().substring(0,10) + '.enc'
      );
    } catch(e) {
      alert(LANGS[currentLang].encAlertErr + e.message);
    }
  });
}

// â”€â”€ PASSWORD MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showPasswordModal(callback) {
  // Remove existing modal if any
  document.getElementById('hf-modal')?.remove();

  const overlay = document.createElement('div');
  overlay.id = 'hf-modal';
  overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:10000;display:flex;align-items:center;justify-content:center;';

  overlay.innerHTML = `
    <div style="background:var(--bg2);border:1px solid var(--border);padding:28px;min-width:340px;max-width:90vw;position:relative;">
      <div style="position:absolute;top:0;left:0;width:2px;height:100%;background:linear-gradient(to bottom,var(--green),transparent);opacity:.6;"></div>
      <div style="font-size:15px;letter-spacing:2px;color:var(--text-dim);margin-bottom:16px;text-transform:uppercase;">${LANGS[currentLang].encTitle}</div>
      <div style="font-size:15px;color:var(--text-dim);margin-bottom:16px;line-height:1.7;letter-spacing:.5px;">
        ${LANGS[currentLang].encDesc}
        <span style="color:var(--green-dim);font-size:14px;letter-spacing:1px;">openssl enc -d -aes-256-cbc -pbkdf2 -in arquivo.enc -out resultado.txt</span>
      </div>
      <input id="hf-pwd" type="password"
        style="width:100%;background:transparent;border:none;border-bottom:1px solid var(--border);color:var(--green);font-family:'Inconsolata',monospace;font-size:16px;padding:8px 0;outline:none;caret-color:var(--green);letter-spacing:2px;margin-bottom:8px;"
        placeholder="${LANGS[currentLang].encPwd1}" autocomplete="off"/>
      <input id="hf-pwd2" type="password"
        style="width:100%;background:transparent;border:none;border-bottom:1px solid var(--border);color:var(--green);font-family:'Inconsolata',monospace;font-size:16px;padding:8px 0;outline:none;caret-color:var(--green);letter-spacing:2px;margin-bottom:20px;"
        placeholder="${LANGS[currentLang].encPwd2}" autocomplete="off"/>
      <div id="hf-pwd-err" style="font-size:15px;color:var(--red);min-height:16px;margin-bottom:12px;letter-spacing:1px;"></div>
      <div style="display:flex;gap:10px;">
        <button id="hf-confirm" style="background:transparent;border:1px solid var(--green);color:var(--green);font-family:'Inconsolata',monospace;font-size:11px;padding:8px 20px;cursor:pointer;letter-spacing:2px;text-transform:uppercase;transition:all .12s;">${LANGS[currentLang].encConfirm}</button>
        <button id="hf-cancel"  style="background:transparent;border:1px solid var(--border);color:var(--text-dim);font-family:'Inconsolata',monospace;font-size:11px;padding:8px 20px;cursor:pointer;letter-spacing:2px;text-transform:uppercase;transition:all .12s;">${LANGS[currentLang].encCancel}</button>
      </div>
    </div>`;

  document.body.appendChild(overlay);
  document.getElementById('hf-pwd').focus();

  document.getElementById('hf-cancel').onclick = () => { overlay.remove(); callback(null); };
  overlay.onclick = (e) => { if (e.target === overlay) { overlay.remove(); callback(null); } };

  document.getElementById('hf-confirm').onclick = () => {
    const p1 = document.getElementById('hf-pwd').value;
    const p2 = document.getElementById('hf-pwd2').value;
    const err = document.getElementById('hf-pwd-err');
    if (!p1)       { err.textContent = LANGS[currentLang].encErrEmpty; return; }
    if (p1 !== p2) { err.textContent = LANGS[currentLang].encErrMatch; return; }
    overlay.remove();
    callback(p1);
  };

  // Enter key confirms
  [document.getElementById('hf-pwd'), document.getElementById('hf-pwd2')].forEach(el => {
    el.addEventListener('keydown', e => { if (e.key === 'Enter') document.getElementById('hf-confirm').click(); });
  });
}

// â”€â”€ DOWNLOAD HELPER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function triggerDownload(blob, filename) {
  const url = URL.createObjectURL(blob);
  const a   = document.createElement('a');
  a.href = url; a.download = filename; a.click();
  URL.revokeObjectURL(url);
}


// â”€â”€ I18N â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const LANGS = {
  pt: {
    notice:       'nenhuma requisiÃ§Ã£o de rede. Todos os algoritmos usam a <strong style="color:var(--green)">Web Crypto API nativa do browser</strong> (implementaÃ§Ã£o Mozilla/Firefox auditada). Zero cÃ³digo criptogrÃ¡fico manual.',
    s01:          '01 // entrada de frase',
    s02:          '02 // selecione os algoritmos',
    algoDesc:     'Todos os algoritmos abaixo sÃ£o nativos da Web Crypto API â€” implementaÃ§Ã£o auditada pelo Mozilla, integrada ao Tor Browser. Clique para adicionar ao pipeline na ordem desejada.',
    s03:          '03 // pipeline',
    s03b:         '03b // salt pessoal',
    saltInfo:     `O <strong>salt</strong> Ã© um valor extra que entra no cÃ¡lculo do <strong>{algos}</strong>.<br><br>
â€” Pense nele como um <strong>segundo segredo</strong>, separado da sua frase.<br>
â€” Duas pessoas com a mesma frase e mesmo pipeline, mas <strong>salts diferentes</strong>, geram hashes completamente diferentes.<br>
â€” O salt <strong>nÃ£o precisa ser secreto</strong>, mas precisa ser <strong>sempre o mesmo</strong> para reproduzir o resultado.<br>
â€” Exemplos: <code>meu-projeto</code>, <code>hashforge-pessoal</code>, seu nome de usuÃ¡rio.`,
    saltPh:       'digite seu salt pessoal...',
    saltPreview:  'salt: ',
    saltEmpty:    '(vazio â€” usando padrÃ£o)',
    saltWarning:  'âš  salt vazio â€” usando salt padrÃ£o (hashforge-v2)',
    saltDefault:  'padrÃ£o â€” recomendamos personalizar',
    saltCustom:   'salt personalizado âœ“',
    alertSalt:    'Defina um salt pessoal para usar ',

    s04:          '04 // resultado',
    s05:          '05 // perfis salvos',
    iter:         '100k iteraÃ§Ãµes',
    keyDeriv:     'derivaÃ§Ã£o de chave',
    sha1Label:    'âš  ALGORITMO LEGADO â€” USO RESTRITO',
    sha1Desc:     'SHA-1 Ã© criptograficamente quebrado desde 2017 (ataque SHAttered). Use apenas como etapa intermediÃ¡ria no pipeline â€” <strong>nunca como etapa final</strong>.',
    sha1Note:     'somente etapa intermediÃ¡ria',
    pipelineEmpty:'nenhum algoritmo selecionado â€” clique nos botÃµes acima para adicionar',
    clearBtn:     'limpar pipeline',
    runBtn:       'â–¶ EXECUTAR PIPELINE',
    exportPhrase: 'incluir frase original',
    exportNorm:   'incluir frase normalizada',
    exportTxt:    'â¬‡ exportar .txt',
    exportEnc:    'ðŸ”’ exportar .enc (criptografado)',
    saveProfile:  'salvar pipeline atual',
    footer1:      'HASHFORGE v0.3.0 // USO PESSOAL',
    footer2:      'WEB CRYPTO API // ZERO DEPENDÃŠNCIAS',
    profileNamePh:'nome do perfil...',
    phrasePh:     'digite sua frase aqui...',
    normWaiting:  'aguardando entrada...',
    normLabel:    'normalizado: ',
    normEmpty:    '(vazio)',
    pipelineRmTitle: 'remover',
    profileDelTitle: 'excluir',
    profilesEmpty:   'nenhum perfil salvo',
    runProcessing:   'processando...',
    runDone:         'âœ“ concluÃ­do',
    runErrPhrase:    'âš  insira uma frase',
    runErrPipeline:  'âš  pipeline vazio',
    runErrStep:      'âœ— erro no pipeline',
    stepFinal:       ' // RESULTADO FINAL',
    copyHint:        '[ clique para copiar ]',
    copied:          '[ copiado! ]',
    copyErr:         '[ erro ao copiar ]',
    algoUnknown:     'algoritmo desconhecido: ',
    alertProfileName:'dÃª um nome ao perfil',
    alertPipelineEmpty:'pipeline estÃ¡ vazio',
    encTitle:        'criptografar arquivo',
    encDesc:         'O arquivo serÃ¡ criptografado com <strong style="color:var(--green)">AES-256-CBC</strong> compatÃ­vel com OpenSSL.<br>Para descriptografar em qualquer Linux:<br>',
    encPwd1:         'digite a senha...',
    encPwd2:         'confirme a senha...',
    encConfirm:      'confirmar',
    encCancel:       'cancelar',
    encErrEmpty:     'âš  senha nÃ£o pode ser vazia',
    encErrMatch:     'âš  senhas nÃ£o coincidem',
    encAlertErr:     'Erro ao criptografar: ',
    encAlertRun:     'Execute o pipeline primeiro.',
    txtHeader:       'HASHFORGE â€” RESULTADO DO PIPELINE',
    txtSalt:         '  Salt      : ',
    txtDate:         '  Data/hora : ',
    txtPhrase:       '  Frase     : ',
    txtNorm:         '  Norm.     : ',
    txtPipeline:     '  Pipeline  : ',
    txtFooter:       '  HashForge // 100% offline // Web Crypto API',
  },
  en: {
    notice:       'no network requests. All algorithms use the <strong style="color:var(--green)">native browser Web Crypto API</strong> (Mozilla/Firefox audited implementation). Zero manual cryptographic code.',
    s01:          '01 // phrase input',
    s02:          '02 // select algorithms',
    algoDesc:     'All algorithms below are native to the Web Crypto API â€” audited Mozilla implementation, built into Tor Browser. Click to add to the pipeline in the desired order.',
    s03:          '03 // pipeline',
    s03b:         '03b // personal salt',
    saltInfo:     `The <strong>salt</strong> is an extra value that feeds into the <strong>{algos}</strong> calculation.<br><br>
â€” Think of it as a <strong>second secret</strong>, separate from your phrase.<br>
â€” Two people with the same phrase and pipeline, but <strong>different salts</strong>, generate completely different hashes.<br>
â€” The salt <strong>does not need to be secret</strong>, but must <strong>always be the same</strong> to reproduce the result.<br>
â€” Examples: <code>my-project</code>, <code>hashforge-personal</code>, your username.`,
    saltPh:       'enter your personal salt...',
    saltPreview:  'salt: ',
    saltEmpty:    '(empty â€” using default)',
    saltWarning:  'âš  empty salt â€” using default salt (hashforge-v2)',
    saltDefault:  'default â€” we recommend personalizing',
    saltCustom:   'custom salt âœ“',
    alertSalt:    'Set a personal salt to use ',

    s04:          '04 // result',
    s05:          '05 // saved profiles',
    iter:         '100k iterations',
    keyDeriv:     'key derivation',
    sha1Label:    'âš  LEGACY ALGORITHM â€” RESTRICTED USE',
    sha1Desc:     'SHA-1 has been cryptographically broken since 2017 (SHAttered attack). Use only as an intermediate step in the pipeline â€” <strong>never as the final step</strong>.',
    sha1Note:     'intermediate step only',
    pipelineEmpty:'no algorithm selected â€” click the buttons above to add',
    clearBtn:     'clear pipeline',
    runBtn:       'â–¶ RUN PIPELINE',
    exportPhrase: 'include original phrase',
    exportNorm:   'include normalized phrase',
    exportTxt:    'â¬‡ export .txt',
    exportEnc:    'ðŸ”’ export .enc (encrypted)',
    saveProfile:  'save current pipeline',
    footer1:      'HASHFORGE v0.3.0 // PERSONAL USE',
    footer2:      'WEB CRYPTO API // ZERO DEPENDENCIES',
    profileNamePh:'profile name...',
    phrasePh:     'type your phrase here...',
    normWaiting:  'waiting for input...',
    normLabel:    'normalized: ',
    normEmpty:    '(empty)',
    pipelineRmTitle: 'remove',
    profileDelTitle: 'delete',
    profilesEmpty:   'no profiles saved',
    runProcessing:   'processing...',
    runDone:         'âœ“ done',
    runErrPhrase:    'âš  enter a phrase',
    runErrPipeline:  'âš  pipeline is empty',
    runErrStep:      'âœ— pipeline error',
    stepFinal:       ' // FINAL RESULT',
    copyHint:        '[ click to copy ]',
    copied:          '[ copied! ]',
    copyErr:         '[ copy failed ]',
    algoUnknown:     'unknown algorithm: ',
    alertProfileName:'enter a profile name',
    alertPipelineEmpty:'pipeline is empty',
    encTitle:        'encrypt file',
    encDesc:         'The file will be encrypted with <strong style="color:var(--green)">AES-256-CBC</strong> compatible with OpenSSL.<br>To decrypt on any Linux:<br>',
    encPwd1:         'enter password...',
    encPwd2:         'confirm password...',
    encConfirm:      'confirm',
    encCancel:       'cancel',
    encErrEmpty:     'âš  password cannot be empty',
    encErrMatch:     'âš  passwords do not match',
    encAlertErr:     'Encryption error: ',
    encAlertRun:     'Run the pipeline first.',
    txtHeader:       'HASHFORGE â€” PIPELINE RESULT',
    txtSalt:         '  Salt      : ',
    txtDate:         '  Date/time : ',
    txtPhrase:       '  Phrase    : ',
    txtNorm:         '  Norm.     : ',
    txtPipeline:     '  Pipeline  : ',
    txtFooter:       '  HashForge // 100% offline // Web Crypto API',
  }
};

let currentLang = navigator.language.startsWith('pt') ? 'pt' : 'en';

function setLang(lang) {
  currentLang = lang;
  document.getElementById('btn-pt').classList.toggle('active', lang === 'pt');
  document.getElementById('btn-en').classList.toggle('active', lang === 'en');
  document.documentElement.lang = lang === 'pt' ? 'pt-BR' : 'en';

  const t = LANGS[lang];

  // Static data-i18n elements (innerHTML for those with HTML, textContent for plain)
  const htmlKeys = ['notice','sha1Desc','algoDesc','encDesc'];
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.dataset.i18n;
    if (!t[key]) return;
    if (htmlKeys.includes(key)) el.innerHTML = t[key];
    else el.textContent = t[key];
  });

  // Placeholders
  document.getElementById('phraseInput').placeholder = t.phrasePh;
  document.getElementById('profileName').placeholder  = t.profileNamePh;

  // Normalized preview (only update the waiting text if input is empty)
  if (!document.getElementById('phraseInput').value) {
    document.getElementById('normPreview').textContent = t.normWaiting;
  }

  // Re-render pipeline (for remove button titles)
  renderPipeline();
  renderProfiles();
  updateSaltPanel();
}

// Override functions that use text to be lang-aware
const _origRenderPipeline = renderPipeline;

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
renderProfiles();
setLang(currentLang);

function renderProfiles() {
  const list = document.getElementById('profileList');
  if (!profiles.length) { list.innerHTML = '<div class="profiles-empty">' + LANGS[currentLang].profilesEmpty + '</div>'; return; }
  list.innerHTML = '';
  profiles.forEach((p, i) => {
    const item = document.createElement('div'); item.className = 'profile-item';
    item.innerHTML = `<span class="profile-name">${p.name}</span><span class="profile-pipe">${p.pipeline.join(' â†’ ')}</span><button class="profile-del" title="${LANGS[currentLang].profileDelTitle}">Ã—</button>`;
    item.querySelector('.profile-del').addEventListener('click', e => deleteProfile(i, e));
    item.addEventListener('click', () => loadProfile(i));
    list.appendChild(item);
  });
}
</script>
</body>
</html>